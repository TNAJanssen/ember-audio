<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>addon/classes/beat-track.js - ember-audio</title>
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min-ecd4a5d6c0cbee10b168f6aa000c64ea.css" integrity="sha256-HS1ihgXZ6qfUcS5BTehJhV81EZR+I5Q6zx5yGdEqbp0= sha512-T23C9FH3sSw+W00kbZbvWt8h/P1h8Euj3cklmPSZNeyGekNivnCvp7KKIFju5D3blaYVmVaD0oAjbS2c+J+huQ==" >
    <link rel="stylesheet" href="../assets/css/main-81a744c27cc7449efcd5a4308805a56f.css" id="site_styles" integrity="sha256-lmgfQjoLLIO5EO5HRKPt2FejDbtTPO0BGKxn1tqReMI= sha512-55xJjT5gmMB4vtNd+yN+XbPJaSBciawgt9pR/SJDaGxAkJBdaMIazBHi7qKjfs+3F5ZmI6yXztfpcTPyujc6Hg==" >
    <script src="http://yui.yahooapis.com/combo?3.8.0pr2/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div class="yui3-g">
        <div id="sidebar" class="yui3-u">
            <div class="logo">
              <a href="../index.html">
                  ember-audio
              </a>
            </div>
            
            <div id="modules" class="sidebox">
                <div class="hd">
                    <h2 class="no-toc">Modules</h2>
                </div>
                <div class="bd">
                    <ul>
                            <li><a href="../modules/Audio.html">Audio</a>
                            </li>
                            <li><a href="../modules/AudioHelpers.html">AudioHelpers</a>
                            </li>
                            <li><a href="../modules/AudioService.html">AudioService</a>
                            </li>
                            <li><a href="../modules/MusicalConcepts.html">MusicalConcepts</a>
                            </li>
                            <li><a href="../modules/utils.html">utils</a>
                            </li>
                    </ul>
                </div>
            </div>
            
            <div id="classes" class="sidebox">
                <div class="hd">
                    <h2 class="no-toc">Classes</h2>
                </div>
                <div class="bd">
                    <ul>
                            <li><a href="../classes/AudioService.html">AudioService</a></li>
                            <li><a href="../classes/Beat.html">Beat</a></li>
                            <li><a href="../classes/BeatTrack.html">BeatTrack</a></li>
                            <li><a href="../classes/Connectable.html">Connectable</a></li>
                            <li><a href="../classes/Connection.html">Connection</a></li>
                            <li><a href="../classes/Font.html">Font</a></li>
                            <li><a href="../classes/LayeredSound.html">LayeredSound</a></li>
                            <li><a href="../classes/MusicalIdentity.html">MusicalIdentity</a></li>
                            <li><a href="../classes/Note.html">Note</a></li>
                            <li><a href="../classes/Oscillator.html">Oscillator</a></li>
                            <li><a href="../classes/Playable.html">Playable</a></li>
                            <li><a href="../classes/SampledNote.html">SampledNote</a></li>
                            <li><a href="../classes/Sampler.html">Sampler</a></li>
                            <li><a href="../classes/Sound.html">Sound</a></li>
                            <li><a href="../classes/Track.html">Track</a></li>
                            <li><a href="../classes/utils.html">utils</a></li>
                    </ul>
                </div>
            </div>
            
            
            
            
            
            <div class="version-info">
              Version: 0.0.0-alpha.1.83ce9881
            </div>
            
        </div>

        <div id="main" class="yui3-u">
            <div class="content"><div class="title">
  <h1 class="file-name">addon/classes/beat-track.js</h1>
</div>

<pre class="code prettyprint linenums">
import Ember from &#x27;ember&#x27;;
import Beat from &#x27;./beat&#x27;;
import Sampler from &#x27;./sampler&#x27;;

const beatBank = new WeakMap();

/**
 * Provides classes that are capable of interacting with the Web Audio API&#x27;s
 * AudioContext.
 *
 * @public
 * @module Audio
 */

const {
  computed
} = Ember;

/**
 * An instance of this class has a single &quot;sound&quot; (comprised of one or multiple
 * audio sources) but provides methods to play that sound repeatedly, mixed with
 * &quot;rests,&quot; in a rhythmic way. An instance of this class behaves very similarly
 * to a &quot;lane&quot; on a drum machine.
 *
 * @public
 * @class BeatTrack
 * @extends Sampler
 *
 * @todo need a way to stop a BeatTrack once it&#x27;s started. Maybe by creating
 * the times in advance and not calling play until it&#x27;s the next beat in the
 * queue?
 */
const BeatTrack = Sampler.extend({

  /**
   * Determines the number of beats in a BeatTrack instance.
   *
   * @public
   * @property numBeats
   * @type {number}
   */
  numBeats: 4,

  /**
   * If specified, Determines length of time, in milliseconds, before isPlaying
   * and currentTimeIsPlaying are automatically switched back to false after
   * having been switched to true for each beat. 100ms is used by default.
   *
   * @public
   * @property duration
   * @type {number}
   * @default 100
   */
  duration: 100,

  /**
   * Computed property. An array of Beat instances. The number of Beat instances
   * in the array is always the same as the &#x60;numBeats&#x60; property. If &#x27;numBeats&#x27;
   * or duration changes. This property will be recomputed, but any beats that
   * previously existed are reused so that they will maintain their &#x60;active&#x60;
   * state.
   *
   * @public
   * @property beats
   * @type {array|Beat}
   */
  beats: computed(&#x27;numBeats&#x27;, &#x27;duration&#x27;, function() {
    let beats = [];
    let numBeats = this.get(&#x27;numBeats&#x27;);
    let existingBeats;

    if (beatBank.has(this)) {
      existingBeats = beatBank.get(this);
      numBeats = numBeats - existingBeats.length;
    }

    for (let i = 0; i &lt; numBeats; i++) {
      const beat = Beat.create({
        duration: this.get(&#x27;duration&#x27;),
        _parentPlayIn: this.playIn.bind(this),
        _parentPlay: this.play.bind(this)
      });

      beats.push(beat);
    }

    if (existingBeats) {
      beats = existingBeats.concat(beats);
    }

    beatBank.set(this, beats);

    return beats;
  }),

  /**
   * Calls play on all Beat instances in the beats array.
   *
   * @public
   * @method playBeats
   *
   * @param {number} bpm The tempo at which the beats should be played.
   *
   * @param noteType {number} The (rhythmic) length of each beat. Fractions
   * are suggested here so that it&#x27;s easy to reason about. For example, for
   * eighth notes, pass in &#x60;1/8&#x60;.
   */
  playBeats(bpm, noteType) {
    this._callPlayMethodOnBeats(&#x27;playIn&#x27;, bpm, noteType);
  },

  /**
   * Calls play on &#x60;active&#x60; Beat instances in the beats array. Any beat that
   * is not marked active is effectively a &quot;rest&quot;.
   *
   * @public
   * @method playActiveBeats
   *
   * @param {number} bpm The tempo at which the beats and rests should be played.
   *
   * @param noteType {number} The (rhythmic) length of each beat/rest. Fractions
   * are suggested here so that it&#x27;s easy to reason about. For example, for
   * eighth notes, pass in &#x60;1/8&#x60;.
   */
  playActiveBeats(bpm, noteType) {
    this._callPlayMethodOnBeats(&#x27;ifActivePlayIn&#x27;, bpm, noteType);
  },

  /**
   * The underlying method behind playBeats and playActiveBeats.
   *
   * @private
   * @method _callPlayMethodOnBeats
   *
   * @param {string} method The method that should be called on each beat.
   *
   * @param {number} bpm The tempo that should be used to calculate the length
   * of a beat/rest.
   *
   * @param noteType {number} The (rhythmic) length of each beat/rest that should
   * be used to calculate the length of a beat/rest in seconds.
   */
  _callPlayMethodOnBeats(method, bpm, noteType=1 / 4) {
    // http://bradthemad.org/guitar/tempo_explanation.php
    const duration = (240 * noteType) / bpm;
    this.get(&#x27;beats&#x27;).map((beat, idx) =&gt; beat[method](idx * duration));
  }
});

export default BeatTrack;

</pre>

</div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min-8dcb0650a8bd6a247abff6765e43040d.js" integrity="sha256-diihLR0asHHxFN+NqoV4qpSvexH85SSJukuSkTxrcEA= sha512-zTGRkp/yAiVPNmxPJ7k2NnZe7aR2xXeAGDNaQnFTbvTARElf+UXMiDydPtR3n7LVZkqioLtxhkY9funHfhIp5A==" ></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify-da760a61cb717e2aa0032f496f9d95d0.js" integrity="sha256-OceGphJyxBL0QHqDhUPIAqInTT4yDCdKiwPM5cM2Di8= sha512-mHOjxDVAmJtGveeZiOlcpSIj62TLFkwhtokv51d+96obX359cFYd+xdbC3Q6bCSid1EkfbzQIORLCe3MIqT/+Q==" ></script>
</body>
</html>
