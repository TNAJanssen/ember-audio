<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>addon/classes/beat.js - ember-audio</title>
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <script src="http://yui.yahooapis.com/combo?3.8.0pr2/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div class="yui3-g">
        <div id="sidebar" class="yui3-u">
            <div class="logo">
              <a href="../index.html">
                  ember-audio
              </a>
            </div>
            
            <div id="modules" class="sidebox">
                <div class="hd">
                    <h2 class="no-toc">Modules</h2>
                </div>
                <div class="bd">
                    <ul>
                            <li><a href="../modules/Audio.html">Audio</a>
                                <ul>
                                        <li><a href="../modules/Audio.html#BeatTrack">BeatTrack</a></li>
                                        <li><a href="../modules/Audio.html#Sound">Sound</a></li>
                                        <li><a href="../modules/Audio.html#Track">Track</a></li>
                                </ul>
                            </li>
                            <li><a href="../modules/Audio-Service.html">Audio-Service</a>
                            </li>
                            <li><a href="../modules/Musical-Concepts.html">Musical-Concepts</a>
                                <ul>
                                        <li><a href="../modules/Musical-Concepts.html#Beat">Beat</a></li>
                                        <li><a href="../modules/Musical-Concepts.html#Note">Note</a></li>
                                </ul>
                            </li>
                            <li><a href="../modules/utils.html">utils</a>
                            </li>
                    </ul>
                </div>
            </div>
            
            <div id="classes" class="sidebox">
                <div class="hd">
                    <h2 class="no-toc">Classes</h2>
                </div>
                <div class="bd">
                    <ul>
                            <li><a href="../classes/Audio.html">Audio</a></li>
                            <li><a href="../classes/Beat.html">Beat</a></li>
                            <li><a href="../classes/BeatTrack.html">BeatTrack</a></li>
                            <li><a href="../classes/Note.html">Note</a></li>
                            <li><a href="../classes/Sound.html">Sound</a></li>
                            <li><a href="../classes/Track.html">Track</a></li>
                            <li><a href="../classes/utils.html">utils</a></li>
                    </ul>
                </div>
            </div>
            
            
            
            
            
            <div class="version-info">
              Version: 0.0.0.1d61e3e0
            </div>
            
        </div>

        <div id="main" class="yui3-u">
            <div class="content"><div class="title">
  <h1 class="file-name">addon/classes/beat.js</h1>
</div>

<pre class="code prettyprint linenums">
import Ember from &#x27;ember&#x27;;

/**
 * An instance of the Beat class represents a single &quot;beat&quot; on a rhythmic
 * instrument.
 *
 * @module Musical-Concepts
 * @submodule Beat
 */

const {
  computed,
  run: { later }
} = Ember;

/**
 * This class represents a single &quot;beat&quot; for a rhythmic instrument. An instance of this
 * class can be set to &#x60;active&#x60; or not to facilitate the way that most drum
 * machines work (when a beat is not &#x60;active&#x60;, the time that it occupies still
 * exists, but it does not cause audio to play, effectively resulting in a
 * &quot;rest&quot;). It provides properties that track when it is played, and when a &quot;rest&quot;
 * is played in it&#x27;s place.
 *
 * This class does not have the ability to create audio on it&#x27;s own and is\
 * expected be a &quot;child&quot; of one of the Sound classes. See it&#x27;s implementation in
 * {{#crossLink &quot;BeatTrack&quot;}}BeatTrack{{/crossLink}} for an example.
 *
 *     // Cannot play audio on it&#x27;s own.
 *     // Must pass in parentPlay and/or parentPlayIn from a parent class.
 *     Beat.create({
 *       parentPlayIn: this.playIn.bind(this),
 *       parentPlay: this.play.bind(this),
 *     });
 *
 * @class Beat
 */
const Beat = Ember.Object.extend({

  /**
   * If &#x60;active&#x60; is &#x60;true&#x60;, all methods of play will cause this instance to play.
   * If &#x60;active&#x60; is &#x60;false&#x60;, the &#x60;playIfActive()&#x60; and &#x60;ifActivePlayIn()&#x60;
   * methods will treat this instance as a rest (a timed period of silence).
   *
   * @property active
   * @type {boolean}
   */
  active: false,

  /**
   * Whether a Beat instance is currently playing, considering both active and
   * inactive beats (rests). When switched to &#x60;true&#x60;, is automatically returned
   * to false after the time specified by the duration property.
   *
   * @property currentTimeIsPlaying
   * @type {boolean}
   * @default false
   */
  currentTimeIsPlaying: false,

  /**
   * Whether a Beat instance is currently playing, considering only active beats.
   * When switched to &#x60;true&#x60;, is automatically returned to false after the time
   * specified by the duration property.
   *
   * @property isPlaying
   * @type {boolean}
   * @default false
   */
  isPlaying: false,

  /**
   * On Beat instance instantiation, this property should be set to the parent&#x27;s
   * audioBuffer.duration.
   *
   * @property audioBufferDuration
   * @type {number|null}
   * @private
   */
  audioBufferDuration: null,

  /**
   * If true, audioBuffer.duration is used instead of durationValue to determine
   * length of time that isPlaying and currentTimeIsPlaying stay true after beat
   * is played.
   *
   * @property durationFromAudioBuffer
   * @type {boolean}
   * @default false
   */
  durationFromAudioBuffer: false,

  /**
   * Determines length of time, in milliseconds, before isPlaying and
   * currentTimeIsPlaying are automatically switched back to false after having
   * been switched to true.
   *
   * If durationFromAudioBuffer is true, this property is not utilized.
   *
   * @property durationValue
   * @type {number}
   * @default 100
   */
  durationValue: 100,

  /**
   * Computed property. Susses out which duration should be used to determine
   * how long isPlaying and currentTimeIsPlaying stay &#x60;true&#x60; after play.
   *
   * By default, this value is set to durationValue, if durationFromAudioBuffer
   * is true, then this value is the duration of the parent AudioBuffer.
   *
   * @property duration
   * @type {number}
   * @private
   */
  duration: computed(&#x27;durationFromAudioBuffer&#x27;, &#x27;durationValue&#x27;, &#x27;audioBufferDuration&#x27;, {
    get() {
      const durationFromAudioBuffer = this.get(&#x27;durationFromAudioBuffer&#x27;);
      const audioBufferDuration = this.get(&#x27;audioBufferDuration&#x27;);

      if (durationFromAudioBuffer &amp;&amp; audioBufferDuration) {
        // audioBuffer.duration is seconds but we need milliseconds
        return this.get(&#x27;audioBufferDuration&#x27;) * 1000;
      } else {
        return this.get(&#x27;durationValue&#x27;) || 100;
      }
    }
  }),

  /**
   * Calls it&#x27;s parent&#x27;s &#x60;playIn()&#x60; method directly to play the beat in
   * &#x60;${offset}&#x60; seconds.
   *
   * isPlaying and currentTimeIsPlaying are both marked true after the provided
   * offset has elapsed.
   *
   * @method playIn
   *
   * @param {number} offset Number of seconds from &quot;now&quot; that the audio should
   * play.
   */
  playIn(offset=0) {
    const msOffset = offset * 1000;

    this.get(&#x27;parentPlayIn&#x27;)(offset);

    later(() =&gt; this._markPlaying(), msOffset);
    later(() =&gt; this._markCurrentTimePlaying(), msOffset);
  },

  /**
   * If the beat is marked &#x60;active&#x60;, calls it&#x27;s parent&#x27;s &#x60;playIn()&#x60; method
   * directly to play the beat in &#x60;${offset}&#x60; seconds.
   *
   * If active, isPlaying is marked true after the provided offset has elapsed.
   *
   * currentTimeIsPlaying is marked true after the provided offset has elapsed,
   * even if beat is not active.
   *
   * @method ifActivePlayIn
   *
   * @param {number} offset Number of seconds from &quot;now&quot; that the audio should
   * play.
   */
  ifActivePlayIn(offset=0) {
    const msOffset = offset * 1000;

    if (this.get(&#x27;active&#x27;)) {
      this.get(&#x27;parentPlayIn&#x27;)(offset);
      later(() =&gt; this._markPlaying(), msOffset);
    }

    later(() =&gt; this._markCurrentTimePlaying(), msOffset);
  },

  /**
   * Calls it&#x27;s parent&#x27;s &#x60;play()&#x60; method directly to play the beat immediately.
   *
   * isPlaying and currentTimeIsPlaying are both immediately marked true.
   *
   * @method play
   */
  play() {
    this.get(&#x27;parentPlay&#x27;)();
    this._markPlaying();
    this._markCurrentTimePlaying();
  },

  /**
   * If &#x60;active&#x60;, calls it&#x27;s parent&#x27;s &#x60;play()&#x60; method directly to play the beat
   * immediately.
   *
   * If &#x60;active&#x60;, isPlaying is immediately marked true.
   *
   * currentTimeIsPlaying is immediately marked true, even if beat is not active.
   *
   * @method playIfActive
   */
  playIfActive() {
    if (this.get(&#x27;active&#x27;)) {
      this.get(&#x27;parentPlay&#x27;)();
      this._markPlaying();
    }

    this._markCurrentTimePlaying();
  },

  /**
   * Sets &#x60;isPlaying&#x60; to &#x60;true&#x60; and sets up a timer that sets &#x60;isPlaying&#x60; back
   * to false after &#x60;duration&#x60; has elapsed.
   *
   * @method _markPlaying
   * @private
   */
  _markPlaying() {
    this.set(&#x27;isPlaying&#x27;, true);
    later(() =&gt; this.set(&#x27;isPlaying&#x27;, false), this.get(&#x27;duration&#x27;));
  },

  /**
   * Sets &#x60;currentTimeIsPlaying&#x60; to &#x60;true&#x60; and sets up a timer that sets
   * &#x60;currentTimeIsPlaying&#x60; back to false after &#x60;duration&#x60; has elapsed.
   *
   * @method _markCurrentTimePlaying
   * @private
   */
  _markCurrentTimePlaying() {
    this.set(&#x27;currentTimeIsPlaying&#x27;, true);
    later(() =&gt; this.set(&#x27;currentTimeIsPlaying&#x27;, false), this.get(&#x27;duration&#x27;));
  },
});

export default Beat;

</pre>

</div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
</body>
</html>
